<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Product">

  <select id="get_cate_all">
    SELECT cate_id
         , cate_bg , cate_md, cate_sm
         , cate_name
         , matchYN 
      FROM CATEGORY
    WHERE 1=1
    ORDER BY cate_bg, cate_md, cate_sm
  </select>

  <select id="get_cate_bg">
    SELECT cate_id
         , cate_bg , cate_md, cate_sm
         , cate_name
         , matchYN 
      FROM CATEGORY
    WHERE 1=1
    <if test='cate_bg != null && cate_bg != ""'>
      AND cate_bg=#{cate_bg}
    </if>
      AND cate_md='00'
      AND cate_sm='00'
    ORDER BY cate_bg, cate_md, cate_sm
  </select>

  <select id="get_cate_md">
    SELECT cate_id
         , cate_bg , cate_md, cate_sm
         , cate_name
         , matchYN 
      FROM CATEGORY
    WHERE 1=1
    <if test='cate_bg != null && cate_bg != ""'>
      AND cate_bg=#{cate_bg}
    </if>
    <if test='cate_md != null && cate_md != ""'>
      AND cate_md=#{cate_md}
    </if>
      AND cate_md!='00'
      AND cate_sm='00'
    ORDER BY cate_bg, cate_md, cate_sm
  </select>

  <select id="get_cate_sm">
    SELECT cate_id
         , cate_bg
         , cate_md
         , cate_sm
         , cate_name
         , matchYN 
      FROM CATEGORY
    WHERE 1=1
    <if test='cate_bg != null && cate_bg != ""'>
      AND cate_bg=#{cate_bg}
    </if>
    <if test='cate_md != null && cate_md != ""'>
      AND cate_md=#{cate_md}
    </if>
    <if test='cate_sm != null && cate_sm != ""'>
      AND cate_sm=#{cate_sm}
    </if>
      AND cate_md!='00'
      AND cate_sm!='00'
    ORDER BY cate_bg, cate_md, cate_sm
  </select>

  <sql id="select_prd_name">
    SELECT MCH.mch_prd_id
          , MCH.mch_prd_cate
          , CAT.cate_name
          , MCH.mch_prd_name 
          FROM MCH_PRD_LIST AS MCH
          JOIN CATEGORY AS CAT
            ON MCH.mch_prd_cate=CONCAT(CAT.cate_bg, CAT.cate_md, CAT.cate_sm)
        WHERE MCH.mch_prd_name LIKE CONCAT('%', #{prd_name},'%')
      <if test='prd_id != null && prd_id != ""'>
        AND MCH.mch_prd_id=#{prd_id}
      </if>
  </sql>

  <select id="search_prd_name">
     <include refid="select_prd_name" />
        ORDER BY MCH.mch_prd_id DESC
        <if test='page != null && page != "" && size != null && size != ""'>
          LIMIT ${page}, ${size}
        </if>
  </select>

  <select id="search_cnt_prd_name">
    SELECT COUNT(*) AS total FROM (
      <include refid="select_prd_name" />
    ) AS TBL
  </select>

  <insert id="insert_user">
    INSERT INTO madangiron.USER_INFO 
        (user_id, user_pw, user_name, user_nickname) VALUES 
        (#{user_id}, #{user_pw}, #{user_name}, #{user_nickname})        
  </insert>

</mapper>